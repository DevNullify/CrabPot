FROM openclaw/openclaw:{{ openclaw_tag }}

# ── Remove dangerous binaries ─────────────────────────────
USER root
RUN apt-get remove --purge -y \
        curl wget netcat-openbsd ncat ssh openssh-client \
        apt dpkg 2>/dev/null; \
    rm -rf /var/lib/apt /var/cache/apt /usr/bin/curl /usr/bin/wget \
           /usr/bin/nc /usr/bin/ssh /usr/bin/apt-get /usr/bin/dpkg; \
    find / -perm /4000 -type f -exec chmod u-s {} + 2>/dev/null; \
    find / -perm /2000 -type f -exec chmod g-s {} + 2>/dev/null; \
    true

# ── Create data directory for persistence ─────────────────
RUN mkdir -p /app/data && chown 1000:1000 /app/data

# ── Run as non-root ───────────────────────────────────────
USER 1000:1000

EXPOSE 18789
